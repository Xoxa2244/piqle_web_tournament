<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DUPR Login URL Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        iframe {
            width: 100%;
            height: 600px;
            border: 2px solid #333;
            border-radius: 4px;
        }
        .url-display {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            word-break: break-all;
            margin: 10px 0;
        }
        button {
            background: #0070f3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0051cc;
        }
        .status {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
        }
        .success {
            background: #d4edda;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
    <h1>DUPR Integration URL Test</h1>
    
    <div class="test-section">
        <h2>Test Configuration</h2>
        <p><strong>Client Key:</strong> <code>test-ck-77f42fa9-c96b-45b7-ffb2-7f1d83376a82</code></p>
        <p><strong>Client ID:</strong> <code>7094449209</code></p>
        <p><strong>Expected URL:</strong></p>
        <div class="url-display">
            https://uat.dupr.gg/login-external-app/test-ck-77f42fa9-c96b-45b7-ffb2-7f1d83376a82
        </div>
    </div>

    <div class="test-section">
        <h2>Test 1: Direct URL Access</h2>
        <p>Click the button below to open the DUPR login page in a new tab:</p>
        <button onclick="window.open('https://uat.dupr.gg/login-external-app/test-ck-77f42fa9-c96b-45b7-ffb2-7f1d83376a82', '_blank')">
            Open DUPR Login in New Tab
        </button>
        <div id="direct-test-status"></div>
    </div>

    <div class="test-section">
        <h2>Test 2: Iframe Embed</h2>
        <p>This simulates how the login will appear in the modal:</p>
        <iframe 
            id="dupr-iframe"
            src="https://uat.dupr.gg/login-external-app/test-ck-77f42fa9-c96b-45b7-ffb2-7f1d83376a82"
            title="DUPR Login"
            allow="camera; microphone"
        ></iframe>
        <div id="iframe-status"></div>
    </div>

    <div class="test-section">
        <h2>Test 3: PostMessage Listener</h2>
        <p>This will log any messages received from the DUPR iframe:</p>
        <button onclick="startListening()">Start Listening for Messages</button>
        <button onclick="stopListening()">Stop Listening</button>
        <div id="message-log" style="max-height: 200px; overflow-y: auto; margin-top: 10px; padding: 10px; background: #f9f9f9; border-radius: 4px;">
            <p><em>Click "Start Listening" to begin...</em></p>
        </div>
    </div>

    <script>
        let messageListener = null;

        function logMessage(message, type = 'info') {
            const logDiv = document.getElementById('message-log');
            const timestamp = new Date().toLocaleTimeString();
            const entry = document.createElement('div');
            entry.style.marginBottom = '5px';
            entry.style.padding = '5px';
            entry.style.borderLeft = '3px solid ' + (type === 'error' ? '#dc3545' : type === 'success' ? '#28a745' : '#007bff');
            entry.innerHTML = `<strong>[${timestamp}]</strong> ${message}`;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function startListening() {
            if (messageListener) {
                logMessage('Already listening for messages', 'info');
                return;
            }

            messageListener = (event) => {
                logMessage(`Message from origin: ${event.origin}`, 'info');
                logMessage(`Data: ${JSON.stringify(event.data, null, 2)}`, 'info');
                
                // Check if it looks like DUPR login data
                if (event.data && typeof event.data === 'object') {
                    const data = event.data;
                    if (data.duprId || data.dupr_id || data.userId) {
                        logMessage('✅ DUPR login data detected!', 'success');
                    }
                }
            };

            window.addEventListener('message', messageListener);
            logMessage('✅ Started listening for postMessage events', 'success');
        }

        function stopListening() {
            if (messageListener) {
                window.removeEventListener('message', messageListener);
                messageListener = null;
                logMessage('Stopped listening for messages', 'info');
            }
        }

        // Auto-start listening when page loads
        window.addEventListener('load', () => {
            setTimeout(() => {
                startListening();
            }, 1000);
        });

        // Check if iframe loads successfully
        document.getElementById('dupr-iframe').addEventListener('load', () => {
            document.getElementById('iframe-status').innerHTML = 
                '<div class="status success">✅ Iframe loaded successfully</div>';
        });

        document.getElementById('dupr-iframe').addEventListener('error', () => {
            document.getElementById('iframe-status').innerHTML = 
                '<div class="status error">❌ Iframe failed to load</div>';
        });
    </script>
</body>
</html>

