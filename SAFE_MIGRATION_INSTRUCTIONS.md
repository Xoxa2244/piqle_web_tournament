# Безопасная миграция (без удаления данных)

## ⚠️ ВАЖНО: Что удалится в новой миграции?

Если вы примените `add-tournament-ratings-simple.sql` или `add-tournament-ratings.sql`, то:
- **Удалится таблица `tournament_ratings`** со всеми данными (лайки/дизлайки)
- Затем создастся новая таблица с правильными типами

## ✅ Безопасный вариант (рекомендуется)

Используйте файл **`add-tournament-ratings-update-only.sql`** — он:
- ✅ **НЕ удаляет** существующую таблицу
- ✅ **НЕ удаляет** существующие данные
- ✅ Только исправляет типы колонок (TEXT → UUID, TEXT → RatingType)
- ✅ Создает недостающие индексы и ограничения

## Как применить безопасную миграцию:

1. Откройте Supabase Dashboard → SQL Editor
2. Скопируйте содержимое файла `prisma/migrations/add-tournament-ratings-update-only.sql`
3. Выполните SQL
4. Готово! Данные сохранятся

## Что делает безопасная миграция:

1. Создает enum `RatingType` (если не существует)
2. Если таблица не существует — создает её
3. Если таблица существует:
   - Исправляет тип `tournamentId`: TEXT → UUID
   - Исправляет тип `userId`: TEXT → UUID  
   - Исправляет тип `id`: TEXT → UUID
   - Исправляет тип `rating`: TEXT → RatingType enum
   - Создает недостающие индексы и foreign keys

**Все существующие данные останутся на месте!**

